# Generated SLO specification for tier-1 HTTP API
# Generated with: build-slos.py user-api production --tier tier-1 --type http-api

version: prometheus/v1
service: user-api
labels:
  tier: tier-1
  namespace: production
  service_type: http-api
slos:
- name: user-api-availability
  objective: 99.9
  description: availability SLO for user-api
  sli:
    events:
      errorQuery: |
        sum(rate(http_requests_total{service="user-api",code!~"5.."}[{{window}}]))
        /
        sum(rate(http_requests_total{service="user-api"}[{{window}}]))
  alerting:
    name: user-api-availability
    labels:
      service: user-api
      tier: tier-1
      slo: availability
    annotations:
      summary: High error budget burn for availability
    pageAlert:
      annotations:
        description: Fast burn rate alert - 2h window
    ticketAlert:
      annotations:
        description: Slow burn rate alert - 24h window
- name: user-api-latency_p99
  objective: 99.0
  description: latency_p99 SLO for user-api
  sli:
    events:
      errorQuery: |
        histogram_quantile(0.99,
          sum(rate(http_request_duration_seconds_bucket{service="user-api"}[{{window}}])) by (le)
        ) < 0.5
  alerting:
    name: user-api-latency_p99
    labels:
      service: user-api
      tier: tier-1
      slo: latency_p99
    annotations:
      summary: High error budget burn for latency_p99
    pageAlert:
      annotations:
        description: Fast burn rate alert - 2h window
    ticketAlert:
      annotations:
        description: Slow burn rate alert - 24h window
- name: user-api-latency_p95
  objective: 99.5
  description: latency_p95 SLO for user-api
  sli:
    events:
      errorQuery: |
        histogram_quantile(0.95,
          sum(rate(http_request_duration_seconds_bucket{service="user-api"}[{{window}}])) by (le)
        ) < 0.2
  alerting:
    name: user-api-latency_p95
    labels:
      service: user-api
      tier: tier-1
      slo: latency_p95
    annotations:
      summary: High error budget burn for latency_p95
    pageAlert:
      annotations:
        description: Fast burn rate alert - 2h window
    ticketAlert:
      annotations:
        description: Slow burn rate alert - 24h window
- name: user-api-error_rate
  objective: 99.9
  description: error_rate SLO for user-api
  sli:
    events:
      errorQuery: |
        sum(rate(http_requests_total{service="user-api",code!~"5.."}[{{window}}]))
        /
        sum(rate(http_requests_total{service="user-api"}[{{window}}]))
  alerting:
    name: user-api-error_rate
    labels:
      service: user-api
      tier: tier-1
      slo: error_rate
    annotations:
      summary: High error budget burn for error_rate
    pageAlert:
      annotations:
        description: Fast burn rate alert - 2h window
    ticketAlert:
      annotations:
        description: Slow burn rate alert - 24h window
